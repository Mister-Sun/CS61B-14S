<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
    <h:head> 
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link href="#{facesContext.externalContext.requestContextPath}/resources/css/default.css" rel="stylesheet" type="text/css" />
        <link href="#{facesContext.externalContext.requestContextPath}/resources/css/cssLayout.css" rel="stylesheet" type="text/css" />
        <script src="#{facesContext.externalContext.requestContextPath}/js/geral.js" type="text/javascript" />
        <script src="#{facesContext.externalContext.requestContextPath}/js/global.js" type="text/javascript" />
    </h:head>
    <body style="width: 510px;">

        <div id="fb-root"></div>
        <script>(function(d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id))
                    return;
                js = d.createElement(s);
                js.id = id;
                js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&amp;appId=770850496291473&amp;version=v2.0";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));</script>
        <script>
            // This is called with the results from from FB.getLoginStatus().
            function statusChangeCallback(response) {
                console.log('statusChangeCallback');
                console.log(response);
                // The response object is returned with a status field that lets the
                // app know the current login status of the person.
                // Full docs on the response object can be found in the documentation
                // for FB.getLoginStatus().
                if (response.status === 'connected') {
                    loadInfo();
                    // Logged into your app and Facebook.
                    console.log('You are already logged in.');
                } else if (response.status === 'not_authorized') {
                    // The person is logged into Facebook, but not your app.
                    console.log('Please log into this app.');
                } else {
                    // The person is not logged into Facebook, so we're not sure if
                    // they are logged into this app or not.
                    console.log('Please log into this Facebook.');
                }
            }

            // This function is called when someone finishes with the Login
            // Button.  See the onlogin handler attached to it in the sample
            // code below.
            function checkLoginState() {
                FB.getLoginStatus(function(response) {
                    statusChangeCallback(response);
                });
            }

            window.fbAsyncInit = function() {

                FB.Event.subscribe('auth.authResponseChange', function(response) {
                    if (response.status === 'connected') {
                        loadInfo();
                    }
                });

                FB.init({
                    appId: '770850496291473',
                    cookie: true, // enable cookies to allow the server to access 
                    // the session
                    xfbml: true, // parse social plugins on this page
                    version: 'v2.0' // use version 2.0
                });


                // Now that we've initialized the JavaScript SDK, we call 
                // FB.getLoginStatus().  This function gets the state of the
                // person visiting this page and can return one of three states to
                // the callback you provide.  They can be:
                //
                // 1. Logged into your app ('connected')
                // 2. Logged into Facebook, but not your app ('not_authorized')
                // 3. Not logged into Facebook and can't tell if they are logged into
                //    your app or not.
                //
                // These three cases are handled in the callback function.

                FB.getLoginStatus(function(response) {
                    statusChangeCallback(response);
                });

            };

            // Load the SDK asynchronously
            (function(d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id))
                    return;
                js = d.createElement(s);
                js.id = id;
                js.src = "//connect.facebook.net/en_US/sdk.js";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));

            // Here we run a very simple test of the Graph API after login is
            // successful.  See statusChangeCallback() for when this call is made.
            function loadInfo() {
                console.log('Welcome!  Fetching your information.... ');
                FB.api('/me', function(response) {
                    console.log('Successful login for: ' + response.name);
                    console.log(response);
                    document.getElementById('hiddenForm:fbName').value =
                            response.name;
                    document.getElementById('hiddenForm:fbGender').value =
                            response.gender;
                    document.getElementById('hiddenForm:fbEmail').value =
                            response.email;
                    document.getElementById('hiddenForm:fbId').value = 
                            response.id;
                    document.getElementById('hiddenForm:invisibleClickTarget').click();

                });
            }
        </script>

        <div class="fb-login-button" data-max-rows="1" data-size="medium" data-show-faces="true" data-auto-logout-link="false" scope="public_profile, email, publish_actions"></div>

        <h:form id="hiddenForm" style="display: none;">
            <h:inputHidden id="fbName" value="#{cadPerson.fbName}" />
            <h:inputHidden id="fbGender" value="#{cadPerson.fbGender}" />
            <h:inputHidden id="fbEmail" value="#{cadPerson.fbEmail}" />
            <h:inputHidden id="fbId" value="#{cadPerson.fbId}" />
            <p:commandButton id="invisibleClickTarget" value="Click here" update=":formPessoa" action="#{cadPerson.loadFbInfo()}">
            </p:commandButton>
        </h:form>


        <div align="center">
            <p:ajaxStatus style="width:220px;height:19px;" id="ajaxStamyFormtusPanel" onstart="dlg1.show();" oncomplete="dlg1.hide();"/>  
            <p:dialog id="basicDialog" widgetVar="dlg1" modal="true" closable="false" resizable="false" >  
                <h:graphicImage value="/images/ajax-loader-2.gif" />
            </p:dialog> 
            <br/>
            <h:form id="formPessoa" style="width: 700px;">
                <p:messages autoUpdate="true" id="msg"/>
                <p:growl autoUpdate="true" id="eventosmsg" life="5000"/>
                <p:panel id="acordion" style="width: 700px;" >
                    <p:panel id="reenvioEmail" style="border:transparent " >
                        <p:panel rendered="#{cadPerson.reenvio}"  header="RECONFIRMAÇÃO DE INSCRIÇÃO" style="border:transparent " >
                            <h:panelGrid columns="1" style="font-size: 11px;" id="emailReconf1">
                                <h:panelGroup>
                                    <h:outputLabel id="texto" value="Uma inscrição para o CPF foi encontrada, deseja reenviar o email de confirmação?" style="font-weight: bold"/>
                                </h:panelGroup>
                            </h:panelGrid> 
                            <h:panelGrid columns="1" style="font-size: 11px;" id="emailReconf2">
                                <h:panelGroup>
                                    <p:commandButton process="@this" action="#{cadPerson.reenvioEmail}" value="REENVIAR" update="@form"/>
                                </h:panelGroup>
                            </h:panelGrid> 
                        </p:panel>
                    </p:panel>

                    <p:panel id="dadospessoais" header="DADOS PESSOAIS" style="border:transparent " >
                        <h:panelGrid columns="2" style="font-size: 11px;" id="partName">

                            <h:panelGroup>
                                <h:outputLabel id="cpfLabel" value="CPF" for="cpfField" style="font-weight: bold"/><br/>
                                <p:inputMask id="cpfField" value="#{cadPerson.person.individual.cpf}" style="width: 100px" mask="999.999.999-99" >
                                    <p:ajax  listener="#{cadPerson.validatePerson}" event="blur" update="formPessoa"/>
                                    <p:focus rendered="#{cadPerson.validPerson}" id="foco" for="cpfField" />
                                </p:inputMask>
                            </h:panelGroup>
                            <h:panelGroup>
                                <h:outputLabel id="nameLabel" value="NOME" for="nameField" style="font-weight: bold"/><br/>
                                <p:inputText onchange="Maiuscula(this);" required="true" disabled="#{cadPerson.disableFields}" requiredMessage="Informe o seu nome" id="nameField" value="#{cadPerson.person.individual.name}" 
                                             style="width: 300px" onkeyup="Maiuscula(this);
                                                     notSpecialAndNumbers(this);"/>
                            </h:panelGroup>
                        </h:panelGrid>
                        <h:panelGrid columns="3" style="font-size: 11px;" id="part2"> 
                            <h:panelGroup>
                                <h:outputLabel id="birthLabel" value="NASCIMENTO" for="Nascimento" style="font-weight: bold"/><br/>
                                <p:inputMask  required="true" disabled="#{cadPerson.disableFields}" requiredMessage="Informe a data de nascimento" id="Nascimento"
                                              value="#{cadPerson.person.individual.birthdate}" style="width: 120px" mask="99/99/9999">
                                    <f:convertDateTime pattern="dd/MM/yyyy" locale="pt_BR"/>
                                </p:inputMask>
                            </h:panelGroup>
                            <h:panelGroup>
                                <h:outputLabel id="genderLabel" value="SEXO" for="genderField" style="font-weight: bold"/><br/>
                                <p:selectOneRadio id="genderField" disabled="#{cadPerson.disableFields}" value="#{cadPerson.person.individual.gender}" required="true" requiredMessage="Informe seu gênero." >
                                    <f:selectItems value="#{apoio.genders}"/>
                                </p:selectOneRadio>
                            </h:panelGroup>
                            <h:panelGroup>
                                <h:outputLabel id="tpartLabel" value="Profissão" for="tpartField" style="font-weight: bold"/><br/>
                                <p:selectOneMenu id="tpartField" disabled="#{cadPerson.disableFields}" value="#{cadPerson.person.registeredType}" required="true" requiredMessage="Informe sua profissão.">
                                    <f:selectItem itemLabel="Selecione..." itemValue="" />  
                                    <f:selectItems value="#{apoio.TPart}"/>
                                </p:selectOneMenu>
                            </h:panelGroup>
                        </h:panelGrid>
                        <h:panelGrid columns="1" style="font-size: 11px;" id="part3">
                            <h:panelGroup>
                                <h:outputLabel id="countryLabel" value="PAÍS" for="countryField" style="font-weight: bold"/><br/>
                                <p:selectOneMenu value="#{cadPerson.person.address.country}" disabled="#{cadPerson.disableFields}" required="true" requiredMessage="Informe o país onde reside."
                                                 id="countryField" effect="fade" filter="true" filterMatchMode="startsWith" style="width: 463px" converter="converter">
                                    <p:ajax update="stateField, cityField, neighField" listener="#{cadPerson.loadStates()}"/>
                                    <f:selectItem itemLabel="Selecione o país ..." itemValue="" />
                                    <f:selectItems value="#{cadPerson.countries}" var="c" itemLabel="#{c.name}" itemValue="#{c}"/>
                                </p:selectOneMenu>
                            </h:panelGroup>
                        </h:panelGrid>
                        <h:panelGrid columns="2" style="font-size: 11px;">
                            <h:panelGroup>
                                <h:outputLabel id="stateLabel"  value="ESTADO" for="stateField" style="font-weight: bold"/><br/>
                                <p:selectOneMenu disabled="#{cadPerson.disableState}"  value="#{cadPerson.person.address.state}" 
                                                 id="stateField" effect="fade" filter="true" filterMatchMode="startsWith" converter="converter" required="true" requiredMessage="Informe o estado que reside."
                                                 style="width: 180px" >
                                    <p:ajax update="cityField, neighField" listener="#{cadPerson.loadCities()}"/>
                                    <f:selectItem itemLabel="Selecione um estado ..." itemValue="" />
                                    <f:selectItems  value="#{cadPerson.states}" var="s" itemLabel="#{s.name}" itemValue="#{s}"/>
                                </p:selectOneMenu>
                            </h:panelGroup>
                            <h:panelGroup>
                                <h:outputLabel id="cityLabel" value="CIDADE" for="cityField" style="font-weight: bold"/><br/>
                                <p:selectOneMenu disabled="#{cadPerson.disableCity}"  value="#{cadPerson.person.address.city}" 
                                                 id="cityField" effect="fade" filter="true" filterMatchMode="startsWith" converter="converter" required="true" requiredMessage="Informe a cidade onde reside."
                                                 style="width: 272px">
                                    <p:ajax update="neighField" listener="#{cadPerson.loadDistricts()}"/>
                                    <f:selectItem itemLabel="Selecione uma cidade ..." itemValue="" />
                                    <f:selectItems value="#{cadPerson.cities}" var="c" itemLabel="#{c.name}" itemValue="#{c}"/>
                                </p:selectOneMenu>
                            </h:panelGroup>
                        </h:panelGrid>
                        <h:panelGrid columns="2" style="font-size: 11px;">
                            <h:panelGroup>
                                <h:outputLabel id="neighLabel" value="BAIRRO" for="neighField" style="font-weight: bold"/><br/>
                                <p:selectOneMenu disabled="#{cadPerson.disableDistrict}"  effect="fade" filter="true" filterMatchMode="startsWith"
                                                 value="#{cadPerson.person.address.district}" id="neighField" converter="converter" required="true" requiredMessage="Informe o bairro que reside."
                                                 style="width: 380px">
                                    <f:selectItem itemLabel="Selecione uma bairro ..." itemValue="" />
                                    <f:selectItems value="#{cadPerson.districts}" var="d" itemLabel="#{d.name}" itemValue="#{d}"/>
                                </p:selectOneMenu>
                            </h:panelGroup>
                            <h:panelGroup>
                                <h:outputLabel id="zipCodeLabel" value="CEP" for="zipCodeField" style="font-weight: bold"/><br/>
                                <p:inputMask id="zipCodeField" value="#{cadPerson.person.address.cep}" disabled="#{cadPerson.disableFields}" style="width: 70px" mask="99999-999"
                                             required="true" requiredMessage="Informe o CEP."/>
                            </h:panelGroup>
                        </h:panelGrid>
                        <h:panelGrid columns="2" style="font-size: 11px;">
                            <h:panelGroup>
                                <h:outputLabel id="logLabel" value="LOGRADOURO" for="logField" style="font-weight: bold"/><br/>
                                <p:inputText id="logField" value="#{cadPerson.person.address.street}" disabled="#{cadPerson.disableFields}" style="width: 400px" onkeyup="Maiuscula(this);
                                        notEspecial(this);" 
                                             required="true" requiredMessage="Informe o logradouro da sua residência."/>
                            </h:panelGroup>
                            <h:panelGroup>
                                <h:outputLabel id="numLabel" value="NÚMERO" for="numField" style="font-weight: bold"/><br/>
                                <p:inputText id="numField" value="#{cadPerson.person.address.number}" disabled="#{cadPerson.disableFields}" style="width: 47px" onkeyup="Maiuscula(this);
                                        notEspecial(this);" 
                                             required="true" requiredMessage="Informe o número da sua residência ou residencial."/>
                            </h:panelGroup>
                        </h:panelGrid>
                        <h:panelGrid columns="1" style="font-size: 11px;">
                            <h:panelGroup>
                                <h:outputLabel id="compLabel" value="COMPLEMENTO" for="compField" style="font-weight: bold"/><br/>
                                <p:inputText id="compField" value="#{cadPerson.person.address.complement}" disabled="#{cadPerson.disableFields}" style="width: 461px" onkeyup="Maiuscula(this);
                                        notEspecial(this);"/>
                            </h:panelGroup>
                        </h:panelGrid>

                        <h:panelGrid columns="1" style="font-size: 11px;">
                            <h:panelGroup>
                                <h:outputLabel id="instLabel" value="INSTITUIÇÃO" for="instField" style="font-weight: bold"/><br/>
                                <p:inputText required="true" requiredMessage="Informe a sua Instituição" disabled="#{cadPerson.disableFields}" id="instField" value="#{cadPerson.person.individual.institution}" 
                                             style="width: 461px" onkeyup="Maiuscula(this);
                                                     notSpecialAndNumbers(this);"/>
                            </h:panelGroup>
                        </h:panelGrid>

                        <h:panelGrid columns="1" style="font-size: 11px;">
                            <h:panelGroup>
                                <h:outputLabel id="credLabel" value="CÓDIGO DE EVENTO PRIVADO(Deixe em branco se não possuir um)" for="credField" style="font-weight: bold"/><br/>
                                <p:inputText disabled="#{cadPerson.disableFields}" id="credField" value="#{cadPerson.credential}" onkeyup ="money(this);"
                                             style="width: 461px"/>
                            </h:panelGroup>
                        </h:panelGrid>

                    </p:panel>
                    <p:panel id="dadosUsuario" header="DADOS DE USUARIO" style="border:transparent ">
                        <h:panelGrid columns="2" style="font-size: 11px;" id="user1"> 
                            <h:panelGroup>
                                <h:outputLabel id="login" value="EMAIL" for="loginField" style="font-weight: bold"/>
                                <p:inputText id="loginField" disabled="#{cadPerson.disableFields}" value="#{cadPerson.person.login.username}" style="width: 100px" onblur="checkMail(this);" />
                            </h:panelGroup>
                        </h:panelGrid>
                        <h:panelGrid columns="2" style="font-size: 11px;" id="user2"> 
                            <h:panelGroup>
                                <h:outputLabel id="pwd" value="SENHA" for="pwdField" style="font-weight: bold"/>
                                <p:password id="pwdField" disabled="#{cadPerson.disableFields}" value="#{cadPerson.person.login.password}" match="pwdConfField" style="width: 100px" />
                            </h:panelGroup>
                        </h:panelGrid>
                        <h:panelGrid columns="2" style="font-size: 11px;" id="user3"> 
                            <h:panelGroup>
                                <h:outputLabel id="pwdConf" value="CONFIRMAÇÃO DE SENHA" for="pwdConfField" style="font-weight: bold"/>
                                <p:password id="pwdConfField" disabled="#{cadPerson.disableFields}" value="#{cadPerson.person.login.passConf}" style="width: 100px"/>
                            </h:panelGroup>
                        </h:panelGrid>
                    </p:panel>
                </p:panel>
                <div align="center">
                    <h:panelGrid columns="2">
                        <p:commandButton action="#{cadPerson.savePerson()}" disabled="#{cadPerson.disableFields}" value="INSCREVER-SE" update="formPessoa" style="width: 130px" ajax="false" onclick="dlg1.show();" oncomplete="dlg1.hide();" >
                        </p:commandButton>
                        <p:commandButton immediate="true" action="#{cadPerson.cleanPersonCadastre()}" value="LIMPAR" process="@this" update="formPessoa" onclick="dlg1.show();" oncomplete="dlg1.hide();"/>
                    </h:panelGrid>
                </div>
            </h:form>

        </div>
    </body>
</html>
